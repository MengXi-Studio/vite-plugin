# 快速开始

<cite>
**本文引用的文件**
- [packages/core/package.json](file://packages/core/package.json)
- [packages/core/src/plugins/copyFile/index.ts](file://packages/core/src/plugins/copyFile/index.ts)
- [packages/core/src/plugins/injectIco/index.ts](file://packages/core/src/plugins/injectIco/index.ts)
- [packages/core/src/plugins/copyFile/types.ts](file://packages/core/src/plugins/copyFile/types.ts)
- [packages/core/src/plugins/injectIco/types.ts](file://packages/core/src/plugins/injectIco/types.ts)
- [packages/core/src/factory/plugin/index.ts](file://packages/core/src/factory/plugin/index.ts)
- [packages/core/src/common/fs/index.ts](file://packages/core/src/common/fs/index.ts)
- [packages/core/src/logger/index.ts](file://packages/core/src/logger/index.ts)
- [packages/playground/vite.config.ts](file://packages/playground/vite.config.ts)
- [packages/test/vite.config.ts](file://packages/test/vite.config.ts)
- [packages/docs/src/en/installation.md](file://packages/docs/src/en/installation.md)
- [packages/docs/src/plugins/copy-file.md](file://packages/docs/src/plugins/copy-file.md)
- [packages/docs/src/plugins/inject-ico.md](file://packages/docs/src/plugins/inject-ico.md)
- [packages/playground/package.json](file://packages/playground/package.json)
- [packages/test/src/copyFile/copyFile.test.ts](file://packages/test/src/copyFile/copyFile.test.ts)
- [packages/test/src/injectIco/injectIco.test.ts](file://packages/test/src/injectIco/injectIco.test.ts)
- [packages/docs/src/introduction.md](file://packages/docs/src/introduction.md)
- [packages/docs/src/index.md](file://packages/docs/src/index.md)
</cite>

## 更新摘要
**所做更改**
- 更新版本信息：将安装说明中的版本号从 0.0.2 更新为 0.0.3
- 确保所有文档中的版本信息保持一致
- 维护现有结构和内容的完整性

## 目录
1. [简介](#简介)
2. [安装指南](#安装指南)
3. [内置插件快速开始](#内置插件快速开始)
4. [自定义插件开发](#自定义插件开发)
5. [配置选项详解](#配置选项详解)
6. [使用示例](#使用示例)
7. [验证安装](#验证安装)
8. [故障排除](#故障排除)
9. [最佳实践](#最佳实践)
10. [常见问题解答](#常见问题解答)

## 简介
@Meng-Xi/Vite-Plugin 是一个为 Vite 提供实用插件的工具包，同时也是一个功能完整的 Vite 插件开发框架。该工具包不仅提供开箱即用的插件集合，还导出了核心框架组件，允许开发者基于相同的底层基础设施快速构建自定义插件，实现高度的可扩展性。

### 核心特性
- **增强 Vite 构建流程**：提供实用插件集合，扩展 Vite 功能，简化构建过程中的常见任务
- **插件开发框架**：导出 BasePlugin、Logger、Validator、createPluginFactory 等核心组件
- **高度可配置**：所有功能支持详细配置选项，可根据项目需求自定义行为
- **环境感知能力**：支持根据构建环境条件执行插件功能

### 主要功能
- **内置插件**：copyFile（文件复制）、injectIco（图标注入）
- **核心框架 API**：BasePlugin、createPluginFactory、Logger、Validator

**章节来源**
- [packages/docs/src/introduction.md](file://packages/docs/src/introduction.md#L1-L47)
- [packages/docs/src/index.md](file://packages/docs/src/index.md#L1-L51)

## 安装指南

### 使用 npm 安装
```bash
npm install @meng-xi/vite-plugin@0.0.3 --save-dev
```

### 使用 yarn 安装
```bash
yarn add @meng-xi/vite-plugin@0.0.3 --save-dev
```

### 使用 pnpm 安装
```bash
pnpm add @meng-xi/vite-plugin@0.0.3 --save-dev
```

**更新** 版本号已更新为 0.0.3，确保用户安装到最新版本

### 验证安装
安装完成后，可以在 Vite 项目中验证安装是否成功：

```typescript
import { defineConfig } from 'vite'
import { copyFile, injectIco } from '@meng-xi/vite-plugin'

export default defineConfig({
  plugins: [
    copyFile({
      sourceDir: 'src/assets',
      targetDir: 'dist/assets'
    }),
    injectIco({
      base: '/assets'
    })
  ]
})
```

**章节来源**
- [packages/docs/src/en/installation.md](file://packages/docs/src/en/installation.md#L1-L87)
- [packages/core/package.json](file://packages/core/package.json#L4-L4)

## 内置插件快速开始

### 文件复制插件（copyFile）
文件复制插件用于在 Vite 构建完成后复制文件或目录到指定位置，支持多种配置选项。

#### 基本配置
```typescript
import { defineConfig } from 'vite'
import { copyFile } from '@meng-xi/vite-plugin'

export default defineConfig({
  plugins: [
    copyFile({
      sourceDir: 'src/assets',
      targetDir: 'dist/assets'
    })
  ]
})
```

#### 完整配置选项
```typescript
export default defineConfig({
  plugins: [
    copyFile({
      sourceDir: 'src/assets',      // 源文件目录（必填）
      targetDir: 'dist/assets',     // 目标文件目录（必填）
      overwrite: true,             // 是否覆盖同名文件
      recursive: true,             // 是否递归复制
      incremental: true,           // 是否启用增量复制
      enabled: true,               // 是否启用插件
      verbose: true,               // 是否显示详细日志
      errorStrategy: 'throw'       // 错误处理策略
    })
  ]
})
```

### 图标注入插件（injectIco）
图标注入插件用于在 Vite 构建过程中注入网站图标链接到 HTML 文件的头部。

#### 基本配置
```typescript
import { defineConfig } from 'vite'
import { injectIco } from '@meng-xi/vite-plugin'

export default defineConfig({
  plugins: [
    injectIco({
      base: '/assets'
    })
  ]
})
```

#### 完整配置选项
```typescript
export default defineConfig({
  plugins: [
    injectIco({
      base: '/assets',              // 图标文件的基础路径
      url: '/assets/favicon.ico',   // 自定义完整 URL
      link: '<link rel="icon" href="/favicon.ico">', // 自定义 link 标签
      icons: [                     // 自定义图标数组
        { rel: 'icon', href: '/favicon.ico', type: 'image/x-icon' }
      ],
      enabled: true,                // 是否启用插件
      verbose: true,                // 是否显示详细日志
      errorStrategy: 'throw',       // 错误处理策略
      copyOptions: {               // 图标文件复制配置
        sourceDir: 'src/assets/icons',
        targetDir: 'dist/assets/icons',
        overwrite: true,
        recursive: true
      }
    })
  ]
})
```

**章节来源**
- [packages/docs/src/plugins/copy-file.md](file://packages/docs/src/plugins/copy-file.md#L1-L159)
- [packages/docs/src/plugins/inject-ico.md](file://packages/docs/src/plugins/inject-ico.md#L1-L258)
- [packages/playground/vite.config.ts](file://packages/playground/vite.config.ts#L1-L69)

## 自定义插件开发

### 基础插件开发
以下是一个完整的自定义插件开发示例：

```typescript
import { BasePlugin, createPluginFactory, Validator } from '@meng-xi/vite-plugin'
import type { Plugin } from 'vite'

interface MyPluginOptions {
  path: string
  enabled?: boolean
  verbose?: boolean
  errorStrategy?: 'throw' | 'log' | 'ignore'
}

class MyPlugin extends BasePlugin<MyPluginOptions> {
  protected getDefaultOptions() {
    return {
      path: './default'
    }
  }

  protected validateOptions(): void {
    this.validator
      .field('path')
      .required()
      .string()
      .validate()
  }

  protected getPluginName(): string {
    return 'my-plugin'
  }

  protected addPluginHooks(plugin: Plugin): void {
    plugin.buildStart = () => {
      this.logger.info(`插件启动，路径: ${this.options.path}`)
    }
  }
}

export const myPlugin = createPluginFactory(MyPlugin)
```

### 高级插件开发
```typescript
import { BasePlugin, createPluginFactory, Validator } from '@meng-xi/vite-plugin'
import type { Plugin } from 'vite'

interface AdvancedPluginOptions {
  config: {
    apiUrl: string
    timeout?: number
  }
  enabled?: boolean
}

class AdvancedPlugin extends BasePlugin<AdvancedPluginOptions> {
  protected getDefaultOptions() {
    return {
      config: {
        apiUrl: 'https://api.example.com',
        timeout: 5000
      }
    }
  }

  protected validateOptions(): void {
    this.validator
      .field('config')
      .object()
      .field('config.apiUrl')
      .required()
      .string()
      .field('config.timeout')
      .number()
      .validate()
  }

  protected getPluginName(): string {
    return 'advanced-plugin'
  }

  protected addPluginHooks(plugin: Plugin): void {
    plugin.configResolved = (config) => {
      this.logger.info('配置已解析')
    }

    plugin.buildStart = () => {
      this.logger.info(`API 地址: ${this.options.config.apiUrl}`)
    }
  }
}

export const advancedPlugin = createPluginFactory(AdvancedPlugin)
```

### 选项标准化器使用
```typescript
// 支持字符串或对象两种输入方式
const myPlugin = createPluginFactory(MyPlugin, (options) => {
  if (typeof options === 'string') {
    return { path: options }
  }
  return options || {}
})

// 使用方式
myPlugin('/path/to/dir')  // 字符串形式
myPlugin({ path: '/path/to/dir' })  // 对象形式
```

**章节来源**
- [packages/docs/src/en/installation.md](file://packages/docs/src/en/installation.md#L46-L82)
- [packages/core/src/factory/plugin/index.ts](file://packages/core/src/factory/plugin/index.ts#L350-L386)

## 配置选项详解

### 基础配置选项
所有插件都支持以下基础配置选项：

| 选项 | 类型 | 默认值 | 描述 |
|------|------|--------|------|
| enabled | boolean | true | 是否启用插件 |
| verbose | boolean | true | 是否显示详细日志 |
| errorStrategy | 'throw' \| 'log' \| 'ignore' | 'throw' | 错误处理策略 |

### copyFile 插件配置选项
| 选项 | 类型 | 默认值 | 描述 |
|------|------|--------|------|
| sourceDir | string | 必填 | 源文件目录路径 |
| targetDir | string | 必填 | 目标文件目录路径 |
| overwrite | boolean | true | 是否覆盖同名文件 |
| recursive | boolean | true | 是否递归复制 |
| incremental | boolean | true | 是否启用增量复制 |

### injectIco 插件配置选项
| 选项 | 类型 | 默认值 | 描述 |
|------|------|--------|------|
| base | string | '/' | 图标文件的基础路径 |
| url | string | undefined | 自定义完整 URL |
| link | string | undefined | 自定义 link 标签 |
| icons | IconObject[] | undefined | 自定义图标数组 |
| copyOptions | CopyOptions | undefined | 图标文件复制配置 |

### copyOptions 配置选项
| 选项 | 类型 | 默认值 | 描述 |
|------|------|--------|------|
| sourceDir | string | 必填 | 图标源文件目录 |
| targetDir | string | 必填 | 图标目标目录 |
| overwrite | boolean | true | 是否覆盖同名文件 |
| recursive | boolean | true | 是否递归复制 |

**章节来源**
- [packages/core/src/plugins/copyFile/types.ts](file://packages/core/src/plugins/copyFile/types.ts#L8-L43)
- [packages/core/src/plugins/injectIco/types.ts](file://packages/core/src/plugins/injectIco/types.ts#L70-L112)
- [packages/docs/src/plugins/copy-file.md](file://packages/docs/src/plugins/copy-file.md#L57-L69)
- [packages/docs/src/plugins/inject-ico.md](file://packages/docs/src/plugins/inject-ico.md#L69-L90)

## 使用示例

### 基础使用场景
```typescript
// 基础文件复制
copyFile({
  sourceDir: 'src/assets',
  targetDir: 'dist/assets'
})

// 基础图标注入
injectIco({
  base: '/assets'
})
```

### 高级使用场景
```typescript
// 环境特定配置
export default defineConfig({
  plugins: [
    copyFile({
      sourceDir: 'src/assets',
      targetDir: 'dist/assets',
      enabled: process.env.NODE_ENV === 'production'
    }),
    injectIco({
      base: '/assets',
      copyOptions: {
        sourceDir: 'src/assets/icons',
        targetDir: 'dist/assets/icons'
      }
    })
  ]
})
```

### 复杂配置示例
```typescript
// 完整的生产环境配置
export default defineConfig({
  plugins: [
    copyFile({
      sourceDir: 'src/static',
      targetDir: 'dist/static',
      overwrite: false,
      recursive: true,
      incremental: true,
      enabled: true,
      verbose: false,
      errorStrategy: 'log'
    }),
    injectIco({
      base: '/static',
      icons: [
        { rel: 'icon', href: '/favicon.ico', type: 'image/x-icon' },
        { rel: 'icon', href: '/favicon.svg', type: 'image/svg+xml' }
      ],
      copyOptions: {
        sourceDir: 'src/assets/icons',
        targetDir: 'dist/assets/icons',
        overwrite: true,
        recursive: true
      },
      enabled: true,
      verbose: true,
      errorStrategy: 'throw'
    })
  ]
})
```

**章节来源**
- [packages/docs/src/plugins/copy-file.md](file://packages/docs/src/plugins/copy-file.md#L70-L141)
- [packages/docs/src/plugins/inject-ico.md](file://packages/docs/src/plugins/inject-ico.md#L91-L221)
- [packages/playground/vite.config.ts](file://packages/playground/vite.config.ts#L11-L69)

## 验证安装

### 基本验证步骤
1. **检查安装**：确认 @meng-xi/vite-plugin@0.0.3 已安装到 node_modules
2. **导入验证**：在 vite.config.ts 中导入插件并注册
3. **构建测试**：运行 npm run build 或 yarn build
4. **日志检查**：观察控制台输出的插件执行日志

### 验证脚本
```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import { copyFile, injectIco } from '@meng-xi/vite-plugin'

export default defineConfig({
  plugins: [
    copyFile({
      sourceDir: 'src/assets',
      targetDir: 'dist/assets',
      verbose: true
    }),
    injectIco({
      base: '/assets',
      verbose: true
    })
  ]
})
```

### 预期输出
```
[插件名称] 成功执行
[插件名称] 复制了 X 个文件，跳过了 Y 个文件，耗时 Zms
[插件名称] 成功注入 N 个图标标签到 HTML 文件
```

**章节来源**
- [packages/docs/src/en/installation.md](file://packages/docs/src/en/installation.md#L1-L87)
- [packages/test/vite.config.ts](file://packages/test/vite.config.ts#L1-L35)

## 故障排除

### 常见问题及解决方案

#### 插件未生效
1. **检查导入语句**：确保正确导入插件
2. **验证配置**：确认 enabled 选项为 true
3. **检查执行时机**：verify 插件是否在正确的构建阶段执行

#### 配置错误
1. **copyFile 配置**：
   - 确保 sourceDir 和 targetDir 为非空字符串
   - 验证路径存在性和可访问性
2. **injectIco 配置**：
   - 检查 copyOptions 配置完整性
   - 验证图标路径有效性

#### 权限问题
1. **源文件权限**：确保源目录有读取权限
2. **目标目录权限**：确保目标目录有写入权限
3. **文件系统权限**：检查磁盘空间和文件系统权限

#### 错误处理策略
```typescript
// 生产环境推荐配置
export default defineConfig({
  plugins: [
    copyFile({
      errorStrategy: 'log'  // 记录错误但不中断构建
    }),
    injectIco({
      errorStrategy: 'log'
    })
  ]
})
```

### 调试技巧
1. **启用详细日志**：设置 verbose: true
2. **检查插件名称**：确认插件名称正确
3. **验证 Vite 版本**：确保兼容的 Vite 版本

**章节来源**
- [packages/docs/src/plugins/copy-file.md](file://packages/docs/src/plugins/copy-file.md#L143-L159)
- [packages/docs/src/plugins/inject-ico.md](file://packages/docs/src/plugins/inject-ico.md#L243-L258)
- [packages/core/src/factory/plugin/index.ts](file://packages/core/src/factory/plugin/index.ts#L283-L311)

## 最佳实践

### 性能优化
1. **启用增量复制**：默认启用，可显著提升重复构建速度
2. **合理使用递归**：仅在需要时启用递归复制
3. **控制日志级别**：生产环境关闭详细日志

### 环境配置
```typescript
// 根据环境动态配置
const isDev = process.env.NODE_ENV === 'development'

export default defineConfig({
  plugins: [
    copyFile({
      enabled: !isDev,
      verbose: isDev
    }),
    injectIco({
      enabled: !isDev,
      verbose: isDev
    })
  ]
})
```

### 错误处理策略
```typescript
// 不同环境使用不同的错误处理策略
const errorStrategy = process.env.NODE_ENV === 'production' ? 'log' : 'throw'

export default defineConfig({
  plugins: [
    copyFile({ errorStrategy }),
    injectIco({ errorStrategy })
  ]
})
```

### 配置验证
```typescript
// 在插件中添加自定义验证
class MyPlugin extends BasePlugin<MyPluginOptions> {
  protected validateOptions(): void {
    super.validateOptions()
    
    // 自定义验证逻辑
    if (this.options.path.startsWith('/')) {
      throw new Error('路径不能以斜杠开头')
    }
  }
}
```

**章节来源**
- [packages/docs/src/plugins/copy-file.md](file://packages/docs/src/plugins/copy-file.md#L143-L159)
- [packages/docs/src/plugins/inject-ico.md](file://packages/docs/src/plugins/inject-ico.md#L243-L258)

## 常见问题解答

### 如何选择合适的错误处理策略？
- **开发环境**：使用 'throw' 可以及时发现错误
- **生产环境**：使用 'log' 可以避免构建中断
- **CI/CD**：使用 'log' 确保构建流程连续性

### 如何处理大文件复制？
1. **启用增量复制**：自动跳过未修改的文件
2. **分批处理**：将大文件拆分为多个小文件
3. **优化路径**：使用相对路径减少处理时间

### 如何调试插件问题？
1. **启用详细日志**：设置 verbose: true
2. **检查插件名称**：确认插件名称正确
3. **验证配置**：逐步注释配置选项定位问题

### 如何扩展插件功能？
1. **继承 BasePlugin**：基于现有插件扩展功能
2. **使用工厂模式**：创建插件实例的工厂函数
3. **自定义验证器**：添加特定的配置验证逻辑

**章节来源**
- [packages/docs/src/en/installation.md](file://packages/docs/src/en/installation.md#L1-L87)
- [packages/core/src/factory/plugin/index.ts](file://packages/core/src/factory/plugin/index.ts#L1-L386)